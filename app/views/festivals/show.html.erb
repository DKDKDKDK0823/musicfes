<div id="wrapper">
    <%= render 'layouts/user-nav' %>
</div>

<%= render 'layouts/top-nav' %>
<div class="container">
    <div class="row">
        <div class="col-lg-12 index-festival">
            <div class="row">
                <div class="col-xs-4">
                    <%= link_to "/users/#{@festival.user.id}" do %> 
                        <%= @festivaluser.name %>
                        <%= attachment_image_tag  @festival.user, :profile_image, :fill, 50, 50, format: 'jpeg',fallback: 'no_image.png', size: "50x50", class: 'user-image' %>
                    <% end %>
                    <% if @festival.images.attached? %>    
                        <div class="slider-show">            
                            <% @festival.images.each do |image| %>
                                <div><%= image_tag image.variant(combine_options:{resize:"300x300^",crop:"300x300+0+0",gravity: :center}).processed %></div>
                            <% end %>
                        </div>                 
                    <% end %>
                    <% if @festival.images.attached? %>    
                        <div class="slider-nav">            
                            <% @festival.images.each do |image| %>
                                <div><%= image_tag image.variant(combine_options:{resize:"100x100^",crop:"100x100+0+0",gravity: :center}).processed %></div>
                            <% end %>
                        </div>                 
                    <% end %>                
                </div>
            <div class="col-xs-6">
                <table class="table">
                    <tbody>
                        <tr><th>名前</th><th> <%= @festival.name %></th></tr>
                        <tr><th>値段</th><th>  <%= @festival.price %> </th></tr>
                        <tr><th>ジャンル</th><th><%= @festival.genre %></th></tr>
                        <tr><th>開催日</th><th> <%= @festival.day %></th></tr>
                        <tr><th>開催地域</th><th><%= @festival.regions %></th></tr>
                         <tr><th>開催地地図</th><th>
                            <input id="address" type="textbox" value="Sydney, NSW">
                            <input type="button" value="Encode" onclick="codeAddress()">
                            <div id='map'></div></th></tr>
                        <tr><th>コメント</th><th> <%= @festival.introduction %></th></tr>
                        <tr><th></th><th><%= render 'festivals/favorite_festivals', festival: @festival %></th></tr>
                        <tr><th>編集</th><th><%= link_to "投稿編集", "/festivals/#{@festival.id}/edit", class: "btn-flat-border" %><%= link_to "Destroy", festival_path(@festival), method: :delete, class: "btn btn-danger btn-xs destroy_festival_#{@festival.id}", "data-confirm" => "Are you Sure?" %></th></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="row">
                <h1>出演アーティスト</h1>
                <div class="col-lg-2">
                    <>
                </div>
            </div>
            <div class="col-lg-2">
                <h4>出演アーティスト登録</h4>
                <p><%= link_to "アーティスト登録", "/artists/new" %></p>
            </div>
        </div>
    </div>
 </div>

<style>
    #map{
    height: 200px;
    }
</style>

<script>
    let map
    let geocoder

    function initMap(){
    // geocoderを初期化
    geocoder = new google.maps.Geocoder()

    map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: -34.397, lng: 150.644},
    zoom: 8
    });
    }

    function codeAddress(){
    // 入力を取得
    let inputAddress = document.getElementById('address').value;

    // geocodingしたあとmapを移動
    geocoder.geocode( { 'address': inputAddress}, function(results, status) {
        if (status == 'OK') {
    　　　　　　　　　　　　// map.setCenterで地図が移動
        map.setCenter(results[0].geometry.location);

    　　　　　　　　　　　　// google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
        } else {
        alert('Geocode was not successful for the following reason: ' + status);
        }
    });
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7HfuXWmrAbFLpvt7JVx5hhvmiu_vv0&callback=initMap" async defer></script>