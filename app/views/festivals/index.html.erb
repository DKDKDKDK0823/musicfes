<div id="wrapper">
    <%= render 'layouts/user-nav' %>
</div>
<%= render 'layouts/top-nav' %>
<div class="jumbotron background-image1">
    <div class="container">   
        <div class="row">
            <div class="col-lg-12 scroll">
                <% @festival.each do |festival| %>                
                    <div class="col-xs-5  col-xs-offset-1 festival-index-show">                                            
                        <div class="col-lg-5">
                            <div class="col-lg-12 user-index1">
                                <%= link_to "/users/#{festival.user.id}" do %> 
                                    <div class="col text-left">
                                        <p><%= festival.user.name %> <%= attachment_image_tag  festival.user, :profile_image, :fill, 25, 25, format: 'jpeg',fallback: 'no_image.png', size: "25x25", class: 'user-image' %></p>
                                    </div>
                                <% end %>
                            </div>
                            <div class="col-lg-12">
                                <% if festival.images.attached? %>
                                    <div class="slider3">
                                        <% festival.images.each do |image| %> 
                                            <div class="festival">
                                                <%= image_tag image.variant(combine_options:{resize:"300x300^",crop:"300x300+0+0",gravity: :center}).processed %>
                                            </div>
                                        <% end %>
                                    </div>
                                <% end %>
                            </div>
                        </div>
                        <div class="col-lg-7 avicii">                                                       
                            <span data-turbolinks="false">                                                                
                                <div class="col-lg-12 festival-boder">  
                                    <div class="col-lg-1">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><i class="fas fa-check"></i></p>
                                        <% end %>
                                    </div>
                                    <div class="col-lg-9">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><%= festival.name %></p>
                                        <% end %>
                                    </div>
                                </div>
                                <div class="col-lg-12 festival-boder">
                                    <div class="col-lg-1">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><i class="fas fa-check"></i></p>
                                        <% end %>
                                    </div>
                                    <div class="col-lg-9">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><%= festival.adress %></p>
                                        <% end %>
                                    </div>
                                </div>
                                <div class="col-lg-12 festival-boder">
                                    <div class="col-lg-1">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><i class="fas fa-check"></i></p>
                                        <% end %>
                                    </div>
                                    <div class="col-lg-9">
                                        <%= link_to "/festivals/#{festival.id}" do %> 
                                            <p class="text-left"><%= festival.genre %></p>
                                        <% end %>
                                    </div>
                                </div>                              
                            </span>                              
                            <div class="col-lg-12 festival-favorite">
                                <div class="text-right">
                                    <%= render 'festivals/favorite_festivals', festival: festival %>
                                </div>
                            </div>               
                        </div>                                                
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>
<script>



window.onload = function() {
  scroll_effect();

  $(window).scroll(function(){
   scroll_effect();
  });

  function scroll_effect(){
   $('.festival-index-show').each(function(){
    var elemPos = $(this).offset().top;
    var scroll = $(window).scrollTop();
    var windowHeight = $(window).height();
    if (scroll > elemPos - windowHeight){
     $(this).addClass('effect-scroll');
    }
   });
  }

   infiniteScroll();
};

function infiniteScroll() {
    $(window).on('scroll', function(){
     scrollHeight = $(window).height();  //今見ている画面の大きさ
     scrollPosition = scrollHeight + $(window).scrollTop();　//　今見ている+スクロールされた分の大きさ 1
     scrollComponentHeight = $('.jumbotron').get(0).scrollHeight; // 全部の大きさ 2
     page = $('.scroll').length + 1; // params[:page]に贈りたい数字
    if (scrollPosition == scrollComponentHeight){ // 1と2が同じになったら
        $.ajax({
            url: "/festivals",  //送たい先のurl
            type: "GET",
            data: {page: page} // params[:page]で受け取れる形で送る
        }).done(function(data){ //indexのhtmlが丸々dataに入ってくる
            display = $(data).find('.scroll') //scrollクラスを切り出す
            $('.slider3').attr('class', 'slider_ajax')  //名前を変えるだけ
            $('.slider_ajax').attr('class', 'slider3')
            $('.row').append(display); //切り出しdisplayを後ろに突っ込む
            $('.slider3').slick({
                slidesToShow: 1,
                slidesToScroll: 1,
                infinite: true,
                arrows: true,
                dots: true,
                arrows: false,
      });
        })
    }
})
}




</script>